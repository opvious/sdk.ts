#!/usr/bin/env bash

# Workaround script to support persisted queries in the generated code for
# emitting requests.

set -o nounset
set -o errexit
set -o pipefail
shopt -s nullglob

__dirname="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

main() {
  cd "$__dirname/.."
  local out=src/graph.gen.ts
  local tmp=src/graph.gen.ts.tmp
  "$(pnpm bin)/graphql-codegen" --config .codegen.yml
  sed -E 's/\(([A-Z][a-zA-Z0-9_]*)Document,/("@\1",/' "$out" >"$tmp"
  mv "$tmp" "$out"
}

main "$@"
